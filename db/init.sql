CREATE TABLE IF NOT EXISTS Llm (
    id uuid PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    url VARCHAR(512) NOT NULL,
    save_date DATE NOT NULL
);

CREATE TABLE IF NOT EXISTS KeyValuePair (
    id uuid PRIMARY KEY,
    is_header BOOLEAN NOT NULL,
    key VARCHAR(255) UNIQUE,
    value TEXT NOT NULL,
    llm uuid NOT NULL REFERENCES Llm(id)
);

CREATE TABLE IF NOT EXISTS Dataset (
    id uuid PRIMARY KEY,
    tmp BOOLEAN NOT NULL,
    name VARCHAR(255),
    first_save_date TIMESTAMP,
    last_save_date TIMESTAMP,
    origin uuid REFERENCES Dataset(id)
);

CREATE TABLE IF NOT EXISTS Test (
    id uuid PRIMARY KEY,
    tmp BOOLEAN NOT NULL,
    name VARCHAR(255),
    execution_date TIMESTAMP NOT NULL,
    llm uuid NOT NULL REFERENCES Llm(id),
    dataset uuid NOT NULL REFERENCES Dataset(id)
);

CREATE TABLE IF NOT EXISTS QuestionAnswer (
    id uuid PRIMARY KEY,
    domanda TEXT NOT NULL,
    risposta TEXT NOT NULL,
    dataset uuid REFERENCES Dataset(id)

);

CREATE TABLE IF NOT EXISTS TestResult (
    test uuid REFERENCES Test(id),
    qa uuid REFERENCES QuestionAnswer(id),
    is_correct BOOLEAN NOT NULL,
    similarity_score NUMERIC NOT NULL,
    obtained_answer TEXT NOT NULL,
    PRIMARY KEY(test, qa)
);

INSERT INTO Llm (id, name, url, save_date) VALUES
('10000000-0000-0000-0000-000000000001', 'GPT-4', 'https://api.openai.com/v1/gpt-4', '2025-05-28'),
('10000000-0000-0000-0000-000000000002', 'Claude 3', 'https://api.anthropic.com/v1/claude-3', '2025-05-20');

INSERT INTO Dataset (id, tmp, name, first_save_date, last_save_date, origin) VALUES
('20000000-0000-0000-0000-000000000001', FALSE, 'Set di domande generali', '2025-05-15 10:00:00', '2025-05-28 15:00:00', NULL),
('20000000-0000-0000-0000-000000000002', FALSE, 'Subset test temporaneo', '2025-05-25 08:00:00', '2025-05-25 08:00:00', '20000000-0000-0000-0000-000000000001');

INSERT INTO QuestionAnswer (id, domanda, risposta, dataset) VALUES
('30000000-0000-0000-0000-000000000001', 'Qual è la capitale della Spagna?', 'Madrid', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000002', 'Chi ha scoperto l''America?', 'Cristoforo Colombo', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000003', 'Quanto fa 7 x 6?', '42', '20000000-0000-0000-0000-000000000002'),
('30000000-0000-0000-0000-000000000004', 'In che anno è avvenuta la rivoluzione francese?', '1789', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000005', 'Qual è il pianeta più vicino al Sole?', 'Mercurio', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000006', 'Chi ha scritto "Il Principe"?', 'Niccolò Machiavelli', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000007', 'Qual è la radice quadrata di 144?', '12', '20000000-0000-0000-0000-000000000002'),
('30000000-0000-0000-0000-000000000008', 'Quale elemento ha simbolo chimico O?', 'Ossigeno', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000009', 'In quale continente si trova l''Egitto?', 'Africa', '20000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000010', 'Chi dipinse la Cappella Sistina?', 'Michelangelo', '20000000-0000-0000-0000-000000000001');


INSERT INTO Test (id, tmp, name, execution_date, llm, dataset) VALUES
('40000000-0000-0000-0000-000000000001', FALSE, 'Test GPT su Set Domande Generali', '2025-05-30 14:30:00', '10000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001'),
('40000000-0000-0000-0000-000000000002', TRUE, 'Test Claude su Subset', '2025-05-31 09:15:00', '10000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000002');

INSERT INTO TestResult (test, qa, is_correct, similarity_score, obtained_answer) VALUES
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', TRUE, 0.95, 'Madrid'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002', TRUE, 0.93, 'Cristoforo Colombo'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004', TRUE, 0.90, '1789'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000005', TRUE, 0.98, 'Mercurio'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000006', TRUE, 0.94, 'Niccolò Machiavelli'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000008', TRUE, 0.96, 'Ossigeno'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000009', TRUE, 0.92, 'Africa'),
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000010', TRUE, 0.91, 'Michelangelo');


INSERT INTO TestResult (test, qa, is_correct, similarity_score, obtained_answer) VALUES
('40000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000003', FALSE, 0.60, '36'),
('40000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000007', TRUE, 0.88, '12');

